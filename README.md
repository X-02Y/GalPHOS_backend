## GalPHOS 微服务架构设计

### 1. **用户认证服务 (User Authentication Service)**
- **职责**: 统一的用户认证、授权、会话管理
- **数据库**: 
  - 用户基础信息表
  - 角色权限表
  - JWT Token黑名单
  - 登录日志
- **核心功能**:
  - 多角色登录 (管理员/教练/学生/阅卷员)
  - JWT Token生成与验证
  - 密码加密与验证
  - 用户会话管理
  - 权限验证
- **内部API**: 提供Token验证接口给其他服务

### 2. **用户管理服务 (User Management Service)**
- **职责**: 用户生命周期管理、用户信息维护
- **数据库**:
  - 独立学生账号表
  - 教练账号表
  - 阅卷员账号表
  - 管理员账号表
  - 教练管理的学生表
  - 用户注册申请表
  - 区域变更申请表
- **核心功能**:
  - 用户注册审核流程
  - 用户资料管理
  - 教练管理的学生创建
  - 区域变更申请处理
  - 用户状态管理
- **内部API**: 提供用户信息查询接口

### 3. **考试管理服务 (Exam Management Service)**
- **职责**: 考试的完整生命周期管理
- **数据库**:
  - 考试基础信息表
  - 考试题目配置表
  - 考试文件表
  - 考试参与者表
  - 考试状态变更日志
- **核心功能**:
  - 考试创建与发布
  - 考试文件管理(试卷、答题卡、答案)
  - 考试时间控制
  - 考试状态管理
  - 考试权限控制
- **内部API**: 提供考试信息查询、状态验证接口

### 4. **答题提交服务 (Submission Service)**
- **职责**: 处理学生答题卡的提交和管理
- **数据库**:
  - 考试提交记录表
  - 答题详情表
  - 提交文件表
  - 提交状态日志
- **核心功能**:
  - 答题卡上传处理
  - 提交时间验证
  - 文件格式验证
  - 提交状态跟踪
  - 教练代理提交
- **内部API**: 提供提交记录查询接口

### 5. **阅卷管理服务 (Grading Service)**
- **职责**: 阅卷任务分配、阅卷过程管理、成绩计算
- **数据库**:
  - 阅卷任务表
  - 阅卷进度表
  - 题目得分表
  - 阅卷员工作记录
  - 成绩复核记录
- **核心功能**:
  - 阅卷任务自动分配
  - 阅卷进度跟踪
  - 分题阅卷管理
  - 成绩合并计算
  - 阅卷质量控制
- **内部API**: 提供阅卷状态查询、成绩计算接口

### 6. **成绩统计服务 (Score Statistics Service)**
- **职责**: 成绩数据分析、排名计算、统计报表
- **数据库**:
  - 学生成绩表
  - 考试统计表
  - 排名数据表
  - 分析报表缓存
- **核心功能**:
  - 实时排名计算
  - 成绩统计分析
  - 多维度数据透视
  - 历史成绩对比
  - 统计报表生成
- **内部API**: 提供统计数据查询接口

### 7. **区域管理服务 (Region Management Service)**
- **职责**: 省份、学校等地理信息管理
- **数据库**:
  - 省份表
  - 学校表
  - 区域层级关系表
- **核心功能**:
  - 省份学校维护
  - 区域层级管理
  - 区域数据同步
- **内部API**: 提供区域信息查询接口

### 8. **文件存储服务 (File Storage Service)**
- **职责**: 文件上传、存储、访问管理
- **数据库**:
  - 文件元数据表
  - 文件访问权限表
  - 文件版本表
- **核心功能**:
  - 文件上传处理
  - 文件格式验证
  - 文件权限控制
  - CDN集成
  - 文件生命周期管理
- **内部API**: 提供文件URL生成、权限验证接口

### 9. **通知服务 (Notification Service)**
- **职责**: 系统消息推送、邮件发送、短信通知
- **数据库**:
  - 通知模板表
  - 通知发送记录
  - 用户通知偏好
- **核心功能**:
  - 多渠道消息推送
  - 通知模板管理
  - 消息队列处理
  - 发送状态跟踪
- **内部API**: 提供通知发送接口

### 10. **系统配置服务 (System Configuration Service)**
- **职责**: 系统全局配置管理
- **数据库**:
  - 系统配置表
  - 配置变更历史
- **核心功能**:
  - 系统参数配置
  - 功能开关管理
  - 配置热更新
  - 配置版本管理
- **内部API**: 提供配置查询接口

## 微服务间通信设计

### 内部API通信模式
1. **同步调用**: 使用HTTP/gRPC进行服务间直接调用
2. **异步消息**: 使用消息队列(如RabbitMQ/Kafka)处理异步操作
3. **事件驱动**: 重要状态变更通过事件总线广播

### 关键业务流程示例

**考试提交流程**:
1. 提交服务接收答题卡 → 调用认证服务验证用户权限
2. 提交服务 → 调用考试管理服务验证考试状态
3. 提交服务 → 调用文件存储服务保存文件
4. 提交服务完成 → 发送事件到阅卷管理服务创建阅卷任务

**阅卷完成流程**:
1. 阅卷服务完成阅卷 → 发送事件到成绩统计服务
2. 成绩统计服务计算排名 → 调用通知服务发送成绩通知

### 数据一致性保证
- **最终一致性**: 通过事件驱动确保数据最终一致
- **分布式事务**: 关键业务使用Saga模式或2PC
- **数据冗余**: 适度的数据冗余提高查询性能

这种微服务架构设计充分考虑了系统的业务复杂性，确保了各服务的独立性和可扩展性，同时通过合理的服务间通信机制保证了业务流程的完整性。